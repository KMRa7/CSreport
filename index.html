<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>æ—¥å ±ãƒ•ã‚©ãƒ¼ãƒ ï¼ˆè‡ªå‹•æ•´å½¢ï¼†ã‚³ãƒ”ãƒ¼ï¼‰</title>
  <style>
    :root {
      --bg-gradient-start: #eef2ff;
      --bg-gradient-end: #fdf2ff;
      --card-bg: #ffffff;
      --accent: #4f46e5;
      --accent-soft: #e0e7ff;
      --border-soft: #e5e7eb;
      --text-main: #111827;
      --text-muted: #6b7280;
      --radius-lg: 16px;
      --shadow-soft: 0 18px 45px rgba(15, 23, 42, 0.08);
    }

    * {
      box-sizing: border-box;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      padding: 32px 16px 40px;
      background: radial-gradient(circle at top left, var(--bg-gradient-start), var(--bg-gradient-end));
      color: var(--text-main);
    }

    .app {
      max-width: 960px;
      margin: 0 auto;
    }

    h1 {
      font-size: 24px;
      margin: 0 0 4px;
      letter-spacing: 0.03em;
    }

    .subtitle {
      font-size: 13px;
      color: var(--text-muted);
      margin-bottom: 20px;
    }

    /* ã‚¿ãƒ–ãƒœã‚¿ãƒ³ */
    .tab-bar-wrapper {
      display: flex;
      justify-content: center;
      margin-bottom: 18px;
    }

    .tab-bar {
      display: inline-flex;
      padding: 4px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.9);
      box-shadow: 0 10px 30px rgba(15, 23, 42, 0.08);
      backdrop-filter: blur(12px);
    }

    .tab-bar button {
      appearance: none;
      border: none;
      background: transparent;
      font-size: 13px;
      padding: 8px 18px;
      border-radius: 999px;
      cursor: pointer;
      color: var(--text-muted);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: background 0.15s ease, color 0.15s ease, transform 0.1s ease;
    }

    .tab-bar button span.dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: var(--border-soft);
    }

    .tab-bar button:hover {
      background: #f9fafb;
      transform: translateY(-1px);
    }

    .tab-bar button.active {
      background: var(--accent);
      color: #ffffff;
    }

    .tab-bar button.active span.dot {
      background: #a5b4fc;
    }

    /* ã‚«ãƒ¼ãƒ‰ */
    .container {
      margin-top: 8px;
    }

    .card {
      background: var(--card-bg);
      border-radius: var(--radius-lg);
      padding: 20px 22px;
      box-shadow: var(--shadow-soft);
      border: 1px solid rgba(148, 163, 184, 0.18);
      display: none;
      opacity: 0;
      transform: translateY(6px);
      transition: opacity 0.18s ease, transform 0.18s ease;
    }

    .card.is-active {
      display: block;
      opacity: 1;
      transform: translateY(0);
    }

    .card-header {
      display: flex;
      align-items: baseline;
      justify-content: space-between;
      margin-bottom: 12px;
      gap: 8px;
    }

    .card-header h2 {
      font-size: 18px;
      margin: 0;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .badge {
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid var(--accent-soft);
      color: #4b5563;
      background: #f9fafb;
    }

    .card-header .hint {
      font-size: 11px;
      color: var(--text-muted);
    }

    /* å…¥åŠ›ç³» */
    .field-row {
      display: flex;
      gap: 8px;
      margin-bottom: 10px;
      align-items: center;
    }

    label {
      font-size: 13px;
      white-space: nowrap;
      color: #374151;
      min-width: 52px;
    }

    input[type="text"] {
      flex: 1;
      padding: 7px 9px;
      font-size: 13px;
      border-radius: 10px;
      border: 1px solid var(--border-soft);
      background: #f9fafb;
      transition: border-color 0.15s ease, box-shadow 0.15s ease, background 0.15s ease;
    }

    input[type="text"]:focus {
      outline: none;
      border-color: var(--accent);
      background: #ffffff;
      box-shadow: 0 0 0 1px rgba(79, 70, 229, 0.3);
    }

    .section-title {
      margin-top: 14px;
      font-weight: 600;
      font-size: 13px;
      border-left: 3px solid var(--accent);
      padding-left: 8px;
      color: #111827;
    }

    .section-title span.small {
      display: block;
      font-weight: normal;
      margin-top: 2px;
    }

    .sub-label {
      font-size: 12px;
      margin-top: 6px;
      margin-bottom: 4px;
      color: var(--text-muted);
    }

    .inline-3 {
      display: grid;
      grid-template-columns: 22px 1fr;
      column-gap: 6px;
      row-gap: 4px;
      align-items: center;
      margin-bottom: 4px;
    }

    .inline-3 span.prefix {
      font-size: 12px;
      color: var(--text-muted);
      text-align: right;
    }

    .small {
      font-size: 11px;
      color: var(--text-muted);
    }

    textarea.output {
      width: 100%;
      box-sizing: border-box;
      min-height: 260px;
      padding: 10px;
      margin-top: 8px;
      border-radius: 12px;
      border: 1px dashed rgba(148, 163, 184, 0.9);
      background: #f9fafb;
      font-family: "Meiryo", system-ui, sans-serif;
      font-size: 13px;
      line-height: 1.5;
      resize: vertical;
      color: #111827;
    }

    textarea.output:focus {
      outline: none;
      border-style: solid;
      border-color: var(--accent);
      background: #ffffff;
      box-shadow: 0 0 0 1px rgba(79, 70, 229, 0.25);
    }

    /* ãƒœã‚¿ãƒ³ */
    .actions {
      margin-top: 8px;
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
    }

    .btn-primary {
      appearance: none;
      border-radius: 999px;
      border: none;
      padding: 8px 18px;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      background: linear-gradient(135deg, var(--accent), #7c3aed);
      color: #ffffff;
      box-shadow: 0 10px 30px rgba(79, 70, 229, 0.35);
      display: inline-flex;
      align-items: center;
      gap: 8px;
      transition: transform 0.08s ease, box-shadow 0.08s ease, filter 0.08s ease;
    }

    .btn-primary:hover {
      transform: translateY(-1px);
      filter: brightness(1.03);
      box-shadow: 0 16px 35px rgba(79, 70, 229, 0.4);
    }

    .btn-primary:active {
      transform: translateY(0);
      box-shadow: 0 10px 24px rgba(79, 70, 229, 0.32);
    }

    .btn-primary .emoji {
      font-size: 14px;
    }

    .btn-secondary {
      appearance: none;
      border-radius: 999px;
      border: 1px solid var(--border-soft);
      padding: 5px 14px;
      font-size: 12px;
      cursor: pointer;
      background: #ffffff;
      color: var(--text-muted);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      margin-top: 4px;
      transition: background 0.15s ease, color 0.15s ease,
                  box-shadow 0.15s ease, transform 0.08s ease;
    }

    .btn-secondary:hover {
      background: #f9fafb;
      color: #374151;
      transform: translateY(-1px);
      box-shadow: 0 6px 18px rgba(148, 163, 184, 0.4);
    }

    .btn-secondary:active {
      transform: translateY(0);
      box-shadow: 0 3px 10px rgba(148, 163, 184, 0.3);
    }

    .msg {
      font-size: 12px;
      color: var(--accent);
    }

    hr {
      margin: 16px 0 10px;
      border: none;
      border-top: 1px dashed rgba(148, 163, 184, 0.6);
    }

    /* 4ä»¶ç›®ä»¥é™ã®åº—èˆ—ãƒ–ãƒ­ãƒƒã‚¯ */
    .store-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-top: 8px;
      margin-bottom: 4px;
    }

    .store-header .store-index {
      font-size: 12px;
      color: var(--text-muted);
    }

    .btn-delete-store {
      appearance: none;
      border-radius: 999px;
      border: none;
      padding: 2px 10px;
      font-size: 11px;
      cursor: pointer;
      background: #fee2e2;
      color: #b91c1c;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      transition: background 0.15s ease, transform 0.08s ease, box-shadow 0.1s ease;
    }

    .btn-delete-store:hover {
      background: #fecaca;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(248, 113, 113, 0.5);
    }

    .btn-delete-store:active {
      transform: translateY(0);
      box-shadow: 0 2px 6px rgba(248, 113, 113, 0.5);
    }

    @media (max-width: 640px) {
      .card {
        padding: 18px 14px;
      }
      .tab-bar {
        width: 100%;
        justify-content: space-between;
      }
      .tab-bar button {
        flex: 1;
        justify-content: center;
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <h1>æ—¥å ±ãƒ•ã‚©ãƒ¼ãƒ </h1>
    <div class="subtitle">ãƒ•ã‚©ãƒ¼ãƒ ã«å…¥åŠ› â†’ ã€Œç”Ÿæˆã—ã¦ã‚³ãƒ”ãƒ¼ã€ãƒœã‚¿ãƒ³ã§ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ¸ˆã¿ãƒ†ã‚­ã‚¹ãƒˆã‚’è‡ªå‹•ç”Ÿæˆï¼†ã‚³ãƒ”ãƒ¼ã—ã¾ã™ã€‚</div>

    <!-- ã‚¿ãƒ–ãƒœã‚¿ãƒ³ -->
    <div class="tab-bar-wrapper">
      <div class="tab-bar">
        <button type="button" id="btn-front" onclick="showForm('front')">
          <span class="dot"></span>
          <span>ï¼ˆãƒ•ãƒ­ãƒ³ãƒˆï¼‰</span>
        </button>
        <button type="button" id="btn-back" onclick="showForm('back')">
          <span class="dot"></span>
          <span>ï¼ˆãƒ•ãƒ­ãƒ³ãƒˆä»¥å¤–ï¼‰</span>
        </button>
      </div>
    </div>

    <div class="container">
      <!-- ãƒ•ãƒ­ãƒ³ãƒˆç”¨ -->
      <div class="card" id="front-card">
        <div class="card-header">
          <h2>
            ï¼ˆãƒ•ãƒ­ãƒ³ãƒˆç”¨ï¼‰
            <span class="badge">Front</span>
          </h2>
          <span class="hint">MTGåº—èˆ—ãƒ™ãƒ¼ã‚¹ã®æ—¥å ±ç”¨ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ</span>
        </div>

        <div class="field-row">
          <label for="front-date">æ—¥ä»˜ï¼š</label>
          <input type="text" id="front-date" placeholder="ä¾‹ï¼‰2025/11/20">
        </div>
        <div class="field-row">
          <label for="front-name">æ°åï¼š</label>
          <input type="text" id="front-name" placeholder="æ°åã‚’å…¥åŠ›">
        </div>

        <div class="section-title">
          â–  æœ¬æ—¥ã®MTGåº—èˆ—
          <span class="small">æœ€å¤§3åº—èˆ—åˆ†ï¼ˆï¼‹ãƒœã‚¿ãƒ³ã§4ä»¶ç›®ä»¥é™ã‚’è¿½åŠ ã§ãã¾ã™ï¼‰</span>
        </div>

        <!-- åº—èˆ—1ã€œ3ï¼ˆå›ºå®šï¼‰ -->
        <div class="sub-label">1ä»¶ç›®</div>
        <div class="field-row">
          <label>åº—èˆ—åï¼š</label>
          <input type="text" id="front-store1-name">
        </div>
        <div class="field-row">
          <label>èª²é¡Œãƒ»ææ¡ˆï¼š</label>
          <input type="text" id="front-store1-issue">
        </div>

        <div class="sub-label">2ä»¶ç›®</div>
        <div class="field-row">
          <label>åº—èˆ—åï¼š</label>
          <input type="text" id="front-store2-name">
        </div>
        <div class="field-row">
          <label>èª²é¡Œãƒ»ææ¡ˆï¼š</label>
          <input type="text" id="front-store2-issue">
        </div>

        <div class="sub-label">3ä»¶ç›®</div>
        <div class="field-row">
          <label>åº—èˆ—åï¼š</label>
          <input type="text" id="front-store3-name">
        </div>
        <div class="field-row">
          <label>èª²é¡Œãƒ»ææ¡ˆï¼š</label>
          <input type="text" id="front-store3-issue">
        </div>

        <div class="small">â€» 4ä»¶ç›®ä»¥é™ã¯ã€Œï¼‹ åº—èˆ—ã‚’è¿½åŠ ã€ãƒœã‚¿ãƒ³ã§å…¥åŠ›æ¬„ã‚’å¢—ã‚„ã›ã¾ã™ã€‚</div>

        <!-- 4ä»¶ç›®ä»¥é™ã‚’è¿½åŠ ã™ã‚‹ã‚³ãƒ³ãƒ†ãƒŠ -->
        <div id="front-extra-stores"></div>
        <button type="button" class="btn-secondary" onclick="addFrontStore()">ï¼‹ åº—èˆ—ã‚’è¿½åŠ </button>

        <div class="section-title">
          â–  æœ¬æ—¥ã®æˆæœãƒ»é€²æ—
          <span class="small">ï¼ˆæ›´æ–°ãƒ»MTGè¨­å®šãªã©è‡ªåˆ†ãªã‚Šã®æˆæœï¼‰</span>
        </div>
        <div class="inline-3">
          <span class="prefix">ãƒ»</span><input type="text" id="front-result1">
          <span class="prefix">ãƒ»</span><input type="text" id="front-result2">
          <span class="prefix">ãƒ»</span><input type="text" id="front-result3">
        </div>

        <div class="section-title">
          â–  èª²é¡Œãƒ»å•é¡Œç‚¹
          <span class="small">ï¼ˆå€‹äººã®èª²é¡Œãƒ»å•é¡Œç‚¹ï¼‰</span>
        </div>
        <div class="inline-3">
          <span class="prefix">ãƒ»</span><input type="text" id="front-issue1">
          <span class="prefix">ãƒ»</span><input type="text" id="front-issue2">
          <span class="prefix">ãƒ»</span><input type="text" id="front-issue3">
        </div>

        <div class="section-title">
          â–  æ˜æ—¥ã®äºˆå®š
          <span class="small">ï¼ˆMTG/MTGå¤–ã®å‹•ãï¼‰</span>
        </div>
        <div class="inline-3">
          <span class="prefix">1.</span><input type="text" id="front-plan1">
          <span class="prefix">2.</span><input type="text" id="front-plan2">
          <span class="prefix">3.</span><input type="text" id="front-plan3">
        </div>

        <div class="section-title">
          â–  æœ¬æ—¥ã®æ°—ã¥ããƒ»æŒ¯ã‚Šè¿”ã‚Š
          <span class="small">ï¼ˆå­¦ã³ãƒ»æ”¹å–„ç‚¹ãªã©ï¼‰</span>
        </div>
        <div class="inline-3">
          <span class="prefix">ãƒ»</span><input type="text" id="front-ref1">
          <span class="prefix">ãƒ»</span><input type="text" id="front-ref2">
          <span class="prefix">ãƒ»</span><input type="text" id="front-ref3">
        </div>

        <hr>

        <div class="small">â–¼ ç”Ÿæˆã•ã‚ŒãŸãƒ†ã‚­ã‚¹ãƒˆï¼ˆè‡ªå‹•æ•´å½¢ï¼‰</div>
        <textarea id="front-output" class="output" readonly></textarea>
        <div class="actions">
          <button class="btn-primary" onclick="generateAndCopyFront()">
            <span class="emoji">ğŸ“</span>
            <span>ãƒ•ãƒ­ãƒ³ãƒˆç”¨ã‚’ç”Ÿæˆã—ã¦ã‚³ãƒ”ãƒ¼</span>
          </button>
          <span id="front-msg" class="msg"></span>
        </div>
      </div>

      <!-- ãƒ•ãƒ­ãƒ³ãƒˆä»¥å¤–ç”¨ -->
      <div class="card" id="back-card">
        <div class="card-header">
          <h2>
            ï¼ˆãƒ•ãƒ­ãƒ³ãƒˆä»¥å¤–ç”¨ï¼‰
            <span class="badge">Back / Office</span>
          </h2>
          <span class="hint">ãƒãƒƒã‚¯ã‚ªãƒ•ã‚£ã‚¹ãƒ»ãã®ä»–æ¥­å‹™ã®æ—¥å ±ç”¨ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ</span>
        </div>

        <div class="field-row">
          <label for="back-date">æ—¥ä»˜ï¼š</label>
          <input type="text" id="back-date" placeholder="ä¾‹ï¼‰2025/11/20">
        </div>
        <div class="field-row">
          <label for="back-name">æ°åï¼š</label>
          <input type="text" id="back-name" placeholder="æ°åã‚’å…¥åŠ›">
        </div>

        <div class="section-title">â–  æœ¬æ—¥ã®æ¥­å‹™å†…å®¹</div>
        <div class="inline-3">
          <span class="prefix">1.</span><input type="text" id="back-work1">
          <span class="prefix">2.</span><input type="text" id="back-work2">
          <span class="prefix">3.</span><input type="text" id="back-work3">
        </div>

        <div class="section-title">â–  æœ¬æ—¥ã®æˆæœãƒ»é€²æ—</div>
        <div class="inline-3">
          <span class="prefix">ãƒ»</span><input type="text" id="back-result1">
          <span class="prefix">ãƒ»</span><input type="text" id="back-result2">
          <span class="prefix">ãƒ»</span><input type="text" id="back-result3">
        </div>

        <div class="section-title">â–  èª²é¡Œãƒ»å•é¡Œç‚¹</div>
        <div class="inline-3">
          <span class="prefix">ãƒ»</span><input type="text" id="back-issue1">
          <span class="prefix">ãƒ»</span><input type="text" id="back-issue2">
          <span class="prefix">ãƒ»</span><input type="text" id="back-issue3">
        </div>

        <div class="section-title">â–  æ˜æ—¥ã®äºˆå®š</div>
        <div class="inline-3">
          <span class="prefix">1.</span><input type="text" id="back-plan1">
          <span class="prefix">2.</span><input type="text" id="back-plan2">
          <span class="prefix">3.</span><input type="text" id="back-plan3">
        </div>

        <div class="section-title">â–  æ°—ã¥ããƒ»æŒ¯ã‚Šè¿”ã‚Šï¼ˆå­¦ã³ãƒ»æ”¹å–„ç‚¹ãªã©ï¼‰</div>
        <div class="inline-3">
          <span class="prefix">ãƒ»</span><input type="text" id="back-ref1">
          <span class="prefix">ãƒ»</span><input type="text" id="back-ref2">
          <span class="prefix">ãƒ»</span><input type="text" id="back-ref3">
        </div>

        <hr>

        <div class="small">â–¼ ç”Ÿæˆã•ã‚ŒãŸãƒ†ã‚­ã‚¹ãƒˆï¼ˆè‡ªå‹•æ•´å½¢ï¼‰</div>
        <textarea id="back-output" class="output" readonly></textarea>
        <div class="actions">
          <button class="btn-primary" onclick="generateAndCopyBack()">
            <span class="emoji">ğŸ“‹</span>
            <span>ãƒ•ãƒ­ãƒ³ãƒˆä»¥å¤–ç”¨ã‚’ç”Ÿæˆã—ã¦ã‚³ãƒ”ãƒ¼</span>
          </button>
          <span id="back-msg" class="msg"></span>
        </div>
      </div>
    </div>
  </div>

  <script>
  // å¯¾è±¡ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ä¸€è¦§ï¼ˆä¿å­˜ãƒ»å¾©å…ƒç”¨ï¼‰
  const FRONT_FIELDS = [
    "front-date","front-name",
    "front-store1-name","front-store1-issue",
    "front-store2-name","front-store2-issue",
    "front-store3-name","front-store3-issue",
    "front-result1","front-result2","front-result3",
    "front-issue1","front-issue2","front-issue3",
    "front-plan1","front-plan2","front-plan3",
    "front-ref1","front-ref2","front-ref3"
  ];

  const BACK_FIELDS = [
    "back-date","back-name",
    "back-work1","back-work2","back-work3",
    "back-result1","back-result2","back-result3",
    "back-issue1","back-issue2","back-issue3",
    "back-plan1","back-plan2","back-plan3",
    "back-ref1","back-ref2","back-ref3"
  ];

  // è‡ªå‹•ä¿å­˜å¯¾è±¡ï¼ˆâ€»æ—¥ä»˜ãƒ»åå‰ã¯é™¤å¤–ï¼‰
  const FRONT_SAVE_FIELDS = FRONT_FIELDS.filter(
    id => id !== "front-date" && id !== "front-name"
  );
  const BACK_SAVE_FIELDS = BACK_FIELDS.filter(
    id => id !== "back-date" && id !== "back-name"
  );

  // â–¼ ãƒ•ã‚©ãƒ¼ãƒ åˆ‡ã‚Šæ›¿ãˆ
  function showForm(type) {
    const frontCard = document.getElementById("front-card");
    const backCard  = document.getElementById("back-card");
    const btnFront  = document.getElementById("btn-front");
    const btnBack   = document.getElementById("btn-back");

    if (type === "front") {
      frontCard.classList.add("is-active");
      backCard.classList.remove("is-active");
      btnFront.classList.add("active");
      btnBack.classList.remove("active");
    } else if (type === "back") {
      frontCard.classList.remove("is-active");
      backCard.classList.add("is-active");
      btnFront.classList.remove("active");
      btnBack.classList.add("active");
    }

    // â˜… æœ€å¾Œã«é–‹ã„ãŸã‚¿ãƒ–ã‚’ä¿å­˜
    try {
      localStorage.setItem("nippoLastTab", type);
    } catch (e) {
      console.error("ã‚¿ãƒ–çŠ¶æ…‹ã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ", e);
    }
  }

  // å…±é€šï¼šå…¥åŠ›å€¤å–å¾—ã®ãƒ˜ãƒ«ãƒ‘ãƒ¼
  function v(id) {
    const el = document.getElementById(id);
    return el ? el.value.trim() : "";
  }

  // å…±é€šï¼šç®‡æ¡æ›¸ãï¼ˆãƒ»ï¼‰ã‚’çµ„ã¿ç«‹ã¦
  function buildBullets(ids) {
    const lines = [];
    ids.forEach(id => {
      const value = v(id);
      if (value) {
        lines.push("ãƒ»" + value);
      }
    });
    return lines.join("\n");
  }

  // å…±é€šï¼šç•ªå·ä»˜ã 1. 2. 3. ã‚’çµ„ã¿ç«‹ã¦
  function buildNumbered(ids) {
    const lines = [];
    ids.forEach((id, index) => {
      const value = v(id);
      if (value) {
        lines.push((index + 1) + ".");
        lines.push(value);
        lines.push(""); // 1ä»¶ã”ã¨ã«ç©ºè¡Œ
      }
    });
    return lines.join("\n").replace(/\n$/, ""); // æœ€å¾Œã®ä½™åˆ†ãªæ”¹è¡Œã‚’èª¿æ•´
  }

  // ===== ãƒ•ãƒ­ãƒ³ãƒˆ MTG 4ä»¶ç›®ä»¥é™ã®å‹•çš„è¿½åŠ  =====
  function addFrontStore(nameValue = "", issueValue = "") {
    const container = document.getElementById("front-extra-stores");
    if (!container) return;

    const currentCount = container.querySelectorAll(".front-extra-store-block").length;
    const index = currentCount + 4; // 4ä»¶ç›®ã‹ã‚‰ã‚¹ã‚¿ãƒ¼ãƒˆ

    const block = document.createElement("div");
    block.className = "front-extra-store-block";

    block.innerHTML = `
      <div class="store-header">
        <span class="sub-label store-index">${index}ä»¶ç›®</span>
        <button type="button" class="btn-delete-store" onclick="removeFrontStore(this)">å‰Šé™¤</button>
      </div>
      <div class="field-row">
        <label>åº—èˆ—åï¼š</label>
        <input type="text"
               id="front-store${index}-name"
               data-store-extra="name">
      </div>
      <div class="field-row">
        <label>èª²é¡Œãƒ»ææ¡ˆï¼š</label>
        <input type="text"
               id="front-store${index}-issue"
               data-store-extra="issue">
      </div>
    `;

    container.appendChild(block);

    const nameInput  = block.querySelector('input[data-store-extra="name"]');
    const issueInput = block.querySelector('input[data-store-extra="issue"]');

    if (nameInput)  nameInput.value  = nameValue || "";
    if (issueInput) issueInput.value = issueValue || "";

    // å‹•çš„è¿½åŠ åˆ†ã‚‚è‡ªå‹•ä¿å­˜ã®å¯¾è±¡ã«
    [nameInput, issueInput].forEach(el => {
      if (!el) return;
      el.addEventListener("change", saveFrontForm);
    });
  }

  function getExtraStores() {
    const container = document.getElementById("front-extra-stores");
    if (!container) return [];
    const blocks = container.querySelectorAll(".front-extra-store-block");
    const stores = [];
    blocks.forEach(block => {
      const nameInput  = block.querySelector('input[data-store-extra="name"]');
      const issueInput = block.querySelector('input[data-store-extra="issue"]');
      const name  = nameInput  ? nameInput.value.trim()  : "";
      const issue = issueInput ? issueInput.value.trim() : "";
      stores.push({ name, issue });
    });
    return stores;
  }

  function clearFrontExtraStores() {
    const container = document.getElementById("front-extra-stores");
    if (!container) return;
    container.innerHTML = "";
  }

  function renumberFrontExtraStores() {
    const container = document.getElementById("front-extra-stores");
    if (!container) return;
    const blocks = container.querySelectorAll(".front-extra-store-block");
    blocks.forEach((block, i) => {
      const label = block.querySelector(".store-index");
      if (label) {
        label.textContent = `${i + 4}ä»¶ç›®`;
      }
    });
  }

  function removeFrontStore(buttonEl) {
    const block = buttonEl.closest(".front-extra-store-block");
    if (!block) return;
    block.remove();
    renumberFrontExtraStores();
    saveFrontForm(); // å‰Šé™¤å¾Œã®çŠ¶æ…‹ã‚’ä¿å­˜
  }

  // ==== ãƒ•ãƒ­ãƒ³ãƒˆç”¨ ä¿å­˜ãƒ»å¾©å…ƒ ====
  function getFrontKey() {
    const date = v("front-date");
    const name = v("front-name");
    if (!date || !name) return null;
    return `nippo_front_${date}_${name}`;
  }

  function clearFrontFormExceptKey() {
    FRONT_FIELDS.forEach(id => {
      if (id === "front-date" || id === "front-name") return;
      const el = document.getElementById(id);
      if (el) el.value = "";
    });
    clearFrontExtraStores();
    const out = document.getElementById("front-output");
    if (out) out.value = "";
  }

  function saveFrontForm() {
    const key = getFrontKey();
    if (!key) return;

    const data = {};
    FRONT_FIELDS.forEach(id => {
      const el = document.getElementById(id);
      if (el) data[id] = el.value;
    });

    // 4ä»¶ç›®ä»¥é™
    data.extraStores = getExtraStores();

    const out = document.getElementById("front-output");
    data.frontOutput = out ? out.value : "";

    try {
      localStorage.setItem(key, JSON.stringify(data));
    } catch (e) {
      console.error("ãƒ•ãƒ­ãƒ³ãƒˆç”¨ãƒ‡ãƒ¼ã‚¿ã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ", e);
    }
  }

  function restoreFrontForm() {
    const key = getFrontKey();
    if (!key) return;

    let raw = null;
    try {
      raw = localStorage.getItem(key);
    } catch (e) {
      console.error("ãƒ•ãƒ­ãƒ³ãƒˆç”¨ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ", e);
    }
    if (!raw) {
      // ä¿å­˜ãƒ‡ãƒ¼ã‚¿ãŒãªã‘ã‚Œã°ã€ãã®æ—¥ä»˜ï¼†åå‰ç”¨ã¨ã—ã¦ç©ºã«ã™ã‚‹
      clearFrontFormExceptKey();
      return;
    }

    try {
      const data = JSON.parse(raw);
      FRONT_FIELDS.forEach(id => {
        if (data[id] !== undefined) {
          const el = document.getElementById(id);
          if (el) el.value = data[id];
        }
      });

      clearFrontExtraStores();
      if (Array.isArray(data.extraStores)) {
        data.extraStores.forEach(store => {
          addFrontStore(store.name || "", store.issue || "");
        });
        renumberFrontExtraStores();
      }

      if (data.frontOutput !== undefined) {
        const out = document.getElementById("front-output");
        if (out) out.value = data.frontOutput;
      }
    } catch (e) {
      console.error("ãƒ•ãƒ­ãƒ³ãƒˆç”¨ãƒ‡ãƒ¼ã‚¿ã®å¾©å…ƒã«å¤±æ•—ã—ã¾ã—ãŸ", e);
    }
  }

  // ==== ãƒ•ãƒ­ãƒ³ãƒˆä»¥å¤–ç”¨ ä¿å­˜ãƒ»å¾©å…ƒ ====
  function getBackKey() {
    const date = v("back-date");
    const name = v("back-name");
    if (!date || !name) return null;
    return `nippo_back_${date}_${name}`;
  }

  function clearBackFormExceptKey() {
    BACK_FIELDS.forEach(id => {
      if (id === "back-date" || id === "back-name") return;
      const el = document.getElementById(id);
      if (el) el.value = "";
    });
    const out = document.getElementById("back-output");
    if (out) out.value = "";
  }

  function saveBackForm() {
    const key = getBackKey();
    if (!key) return;

    const data = {};
    BACK_FIELDS.forEach(id => {
      const el = document.getElementById(id);
      if (el) data[id] = el.value;
    });
    const out = document.getElementById("back-output");
    data.backOutput = out ? out.value : "";

    try {
      localStorage.setItem(key, JSON.stringify(data));
    } catch (e) {
      console.error("ãƒ•ãƒ­ãƒ³ãƒˆä»¥å¤–ç”¨ãƒ‡ãƒ¼ã‚¿ã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ", e);
    }
  }

  function restoreBackForm() {
    const key = getBackKey();
    if (!key) return;

    let raw = null;
    try {
      raw = localStorage.getItem(key);
    } catch (e) {
      console.error("ãƒ•ãƒ­ãƒ³ãƒˆä»¥å¤–ç”¨ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ", e);
    }
    if (!raw) {
      clearBackFormExceptKey();
      return;
    }

    try {
      const data = JSON.parse(raw);
      BACK_FIELDS.forEach(id => {
        if (data[id] !== undefined) {
          const el = document.getElementById(id);
          if (el) el.value = data[id];
        }
      });
      if (data.backOutput !== undefined) {
        const out = document.getElementById("back-output");
        if (out) out.value = data.backOutput;
      }
    } catch (e) {
      console.error("ãƒ•ãƒ­ãƒ³ãƒˆä»¥å¤–ç”¨ãƒ‡ãƒ¼ã‚¿ã®å¾©å…ƒã«å¤±æ•—ã—ã¾ã—ãŸ", e);
    }
  }

  // ãƒ•ãƒ­ãƒ³ãƒˆç”¨ãƒ†ã‚­ã‚¹ãƒˆç”Ÿæˆ
  function buildFrontText() {
    const lines = [];

    lines.push("ã€æ—¥ä»˜ã€‘      ï¼š" + v("front-date"));
    lines.push("ã€æ°åã€‘      ï¼š" + v("front-name"));
    lines.push("");
    lines.push("â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•");
    lines.push("â–  æœ¬æ—¥ã®MTGåº—èˆ—");

    // åº—èˆ—æƒ…å ±ï¼ˆå›ºå®š1ã€œ3ä»¶ï¼‰
    const stores = [
      { name: v("front-store1-name"), issue: v("front-store1-issue") },
      { name: v("front-store2-name"), issue: v("front-store2-issue") },
      { name: v("front-store3-name"), issue: v("front-store3-issue") }
    ];

    // 4ä»¶ç›®ä»¥é™ï¼ˆå‹•çš„ï¼‰
    const extra = getExtraStores();
    extra.forEach(s => stores.push(s));

    let storeIndex = 1;
    stores.forEach(s => {
      if (s.name || s.issue) {
        lines.push(storeIndex + ".");
        lines.push("åº—èˆ—åï¼š" + (s.name || ""));
        lines.push("èª²é¡Œãƒ»ææ¡ˆå†…å®¹ï¼š" + (s.issue || ""));
        lines.push("");
        storeIndex++;
      }
    });

    if (storeIndex === 1) {
      // 1ä»¶ã‚‚å…¥åŠ›ãŒãªã„å ´åˆã¯ã€ã²ãªå½¢ã ã‘å‡ºã™
      lines.push("1.");
      lines.push("åº—èˆ—åï¼š");
      lines.push("èª²é¡Œãƒ»ææ¡ˆå†…å®¹ï¼š");
      lines.push("");
      lines.push("2.");
      lines.push("åº—èˆ—åï¼š");
      lines.push("èª²é¡Œãƒ»ææ¡ˆå†…å®¹ï¼š");
      lines.push("");
      lines.push("3.");
      lines.push("åº—èˆ—åï¼š");
      lines.push("èª²é¡Œãƒ»ææ¡ˆå†…å®¹ï¼š");
      lines.push("");
    }

    lines.push("(ã‚ã‚‹åˆ†è¿½åŠ ã—ã¦ãã ã•ã„)");
    lines.push("â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•");
    lines.push("â–  æœ¬æ—¥ã®æˆæœãƒ»é€²æ—(æ›´æ–°ãƒ»MTGè¨­å®šãªã©è‡ªåˆ†ãªã‚Šã®æˆæœ)");

    const resultBlock = buildBullets(["front-result1", "front-result2", "front-result3"]);
    lines.push(resultBlock || "ãƒ»");
    lines.push("");
    lines.push("â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•");
    lines.push("â–  èª²é¡Œãƒ»å•é¡Œç‚¹(å€‹äººã®èª²é¡Œãƒ»å•é¡Œç‚¹)");

    const issueBlock = buildBullets(["front-issue1", "front-issue2", "front-issue3"]);
    lines.push(issueBlock || "ãƒ»");
    lines.push("");
    lines.push("â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•");
    lines.push("â–  æ˜æ—¥ã®äºˆå®š(MTG/MTGå¤–ã®å‹•ã)");

    const planBlock = buildNumbered(["front-plan1", "front-plan2", "front-plan3"]);
    lines.push(planBlock || "1.\n\n2.\n\n3.");
    lines.push("â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•");
    lines.push("â–  æœ¬æ—¥ã®æ°—ã¥ããƒ»æŒ¯ã‚Šè¿”ã‚Šï¼ˆå­¦ã³ãƒ»æ”¹å–„ç‚¹ãªã©ï¼‰");

    const refBlock = buildBullets(["front-ref1", "front-ref2", "front-ref3"]);
    lines.push(refBlock || "ãƒ»");

    return lines.join("\n");
  }

  // ãƒ•ãƒ­ãƒ³ãƒˆä»¥å¤–ç”¨ãƒ†ã‚­ã‚¹ãƒˆç”Ÿæˆ
  function buildBackText() {
    const lines = [];

    lines.push("ã€æ—¥ä»˜ã€‘      ï¼š" + v("back-date"));
    lines.push("ã€æ°åã€‘      ï¼š" + v("back-name"));
    lines.push("");
    lines.push("â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•");
    lines.push("â–  æœ¬æ—¥ã®æ¥­å‹™å†…å®¹");

    const workBlock = buildNumbered(["back-work1", "back-work2", "back-work3"]);
    lines.push(workBlock || "1.\n\n2.\n\n3.");
    lines.push("â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•");
    lines.push("â–  æœ¬æ—¥ã®æˆæœãƒ»é€²æ—");

    const resultBlock = buildBullets(["back-result1", "back-result2", "back-result3"]);
    lines.push(resultBlock || "ãƒ»");
    lines.push("");
    lines.push("â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•");
    lines.push("â–  èª²é¡Œãƒ»å•é¡Œç‚¹");

    const issueBlock = buildBullets(["back-issue1", "back-issue2", "back-issue3"]);
    lines.push(issueBlock || "ãƒ»");
    lines.push("");
    lines.push("â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•");
    lines.push("â–  æ˜æ—¥ã®äºˆå®š");

    const planBlock = buildNumbered(["back-plan1", "back-plan2", "back-plan3"]);
    lines.push(planBlock || "1.\n\n2.\n\n3.");
    lines.push("â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•");
    lines.push("â–  æ°—ã¥ããƒ»æŒ¯ã‚Šè¿”ã‚Šï¼ˆå­¦ã³ãƒ»æ”¹å–„ç‚¹ãªã©ï¼‰");

    const refBlock = buildBullets(["back-ref1", "back-ref2", "back-ref3"]);
    lines.push(refBlock || "ãƒ»");

    return lines.join("\n");
  }

  // ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã‚³ãƒ”ãƒ¼å…±é€šå‡¦ç†
  function copyText(text, msgSpanId) {
    const msgSpan = document.getElementById(msgSpanId);

    if (navigator.clipboard && window.isSecureContext) {
      navigator.clipboard.writeText(text).then(() => {
        msgSpan.textContent = "ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸã€‚";
        setTimeout(() => { msgSpan.textContent = ""; }, 2000);
      }).catch(err => {
        console.error(err);
        fallbackCopy(text, msgSpan);
      });
    } else {
      fallbackCopy(text, msgSpan);
    }
  }

  function fallbackCopy(text, msgSpan) {
    const temp = document.createElement("textarea");
    temp.value = text;
    document.body.appendChild(temp);
    temp.select();
    temp.setSelectionRange(0, temp.value.length);
    const ok = document.execCommand("copy");
    document.body.removeChild(temp);

    msgSpan.textContent = ok ? "ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸã€‚" : "ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸã€‚";
    setTimeout(() => { msgSpan.textContent = ""; }, 2000);
  }

  function generateAndCopyFront() {
    const text = buildFrontText();
    document.getElementById("front-output").value = text;
    saveFrontForm();   // ç”Ÿæˆæ™‚ã«ä¿å­˜
    copyText(text, "front-msg");
  }

  function generateAndCopyBack() {
    const text = buildBackText();
    document.getElementById("back-output").value = text;
    saveBackForm();    // ç”Ÿæˆæ™‚ã«ä¿å­˜
    copyText(text, "back-msg");
  }

  // â–¼ ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®åˆæœŸå‡¦ç†
  document.addEventListener("DOMContentLoaded", function() {
    // ä»Šæ—¥ã®æ—¥ä»˜ã‚’ YYYY/MM/DD å½¢å¼ã§ä½œæˆ
    const today = new Date();
    const yyyy = today.getFullYear();
    const mm   = String(today.getMonth() + 1).padStart(2, "0");
    const dd   = String(today.getDate()).padStart(2, "0");
    const todayStr = `${yyyy}/${mm}/${dd}`;

    // æ—¥ä»˜æ¬„ãŒç©ºãªã‚‰ä»Šæ—¥ã®æ—¥ä»˜ã‚’å…¥ã‚Œã‚‹
    ["front-date", "back-date"].forEach(id => {
      const el = document.getElementById(id);
      if (el && !el.value) {
        el.value = todayStr;
      }
    });

    // å‰å›ã®åå‰ã‚’ localStorage ã‹ã‚‰å–å¾—
    try {
      const savedName = localStorage.getItem("nippoName");
      if (savedName) {
        ["front-name", "back-name"].forEach(id => {
          const el = document.getElementById(id);
          if (el && !el.value) {
            el.value = savedName;
          }
        });
      }
    } catch (e) {
      console.error("åå‰ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ", e);
    }

    // åå‰ãŒå¤‰æ›´ã•ã‚ŒãŸã‚‰ nippoName ã¨ã—ã¦ä¿å­˜
    ["front-name", "back-name"].forEach(id => {
      const el = document.getElementById(id);
      if (!el) return;
      el.addEventListener("change", () => {
        const name = el.value.trim();
        if (!name) return;
        try {
          localStorage.setItem("nippoName", name);
        } catch (e) {
          console.error("åå‰ã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ", e);
        }
      });
    });

    // å„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å¤‰æ›´æ™‚ã«è‡ªå‹•ä¿å­˜ï¼ˆâ€»æ—¥ä»˜ãƒ»åå‰ã¯é™¤ãï¼‰
    FRONT_SAVE_FIELDS.forEach(id => {
      const el = document.getElementById(id);
      if (!el) return;
      el.addEventListener("change", saveFrontForm);
    });
    BACK_SAVE_FIELDS.forEach(id => {
      const el = document.getElementById(id);
      if (!el) return;
      el.addEventListener("change", saveBackForm);
    });

    // æ—¥ä»˜ or åå‰ãŒå¤‰ã‚ã£ãŸã‚‰ã€Œæ—¥ä»˜ï¼‹åå‰ã€ã§å¾©å…ƒã‚’è©¦ã¿ã‚‹
    ["front-date","front-name"].forEach(id => {
      const el = document.getElementById(id);
      if (!el) return;
      el.addEventListener("change", restoreFrontForm);
    });
    ["back-date","back-name"].forEach(id => {
      const el = document.getElementById(id);
      if (!el) return;
      el.addEventListener("change", restoreBackForm);
    });

    // åˆæœŸè¡¨ç¤ºæ™‚ã€ç¾åœ¨ã®ã€Œæ—¥ä»˜ï¼‹åå‰ã€ã§ä¿å­˜æ¸ˆã¿ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Œã°å¾©å…ƒ
    restoreFrontForm();
    restoreBackForm();

    // â˜… æœ€å¾Œã«é–‹ã„ã¦ã„ãŸã‚¿ãƒ–ã‚’å¾©å…ƒ
    try {
      const lastTab = localStorage.getItem("nippoLastTab");
      if (lastTab === "front" || lastTab === "back") {
        showForm(lastTab);
      }
      // ãã‚Œã‚‚ãªã‘ã‚Œã°ä¸¡æ–¹éè¡¨ç¤ºã®ã¾ã¾ï¼ˆã‚¿ãƒ–ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸã¨ãã«è¡¨ç¤ºï¼‰
    } catch (e) {
      console.error("ã‚¿ãƒ–çŠ¶æ…‹ã®å¾©å…ƒã«å¤±æ•—ã—ã¾ã—ãŸ", e);
    }
  });
</script>

</body>
</html>
